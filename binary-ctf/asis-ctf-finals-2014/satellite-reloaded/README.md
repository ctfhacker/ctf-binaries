# ASIS Cyber Security Contest Finals 2014: Satellite reloaded

**Category:** Reverse
**Points:** 250
**Description:**

> Download [this](2satreloaded_465509d872885f2a92656e29d3881ad6) file and find the flag.

## Write-up

Let’s see what [the provided file](2satreloaded_465509d872885f2a92656e29d3881ad6) could be:

```bash
$ file 2satreloaded_465509d872885f2a92656e29d3881ad6
2satreloaded_465509d872885f2a92656e29d3881ad6: xz compressed data
```

So, we extract the file using the built-in `xz` or `unxz` commands:

* `xz -dc < 2satreloaded_465509d872885f2a92656e29d3881ad6 > sat`
* `unxz < 2satreloaded_465509d872885f2a92656e29d3881ad6 > sat`

Alternatively, extract the provided file using [p7zip](http://p7zip.sourceforge.net/):

```bash
7z x 2satreloaded_465509d872885f2a92656e29d3881ad6
```

Let’s find out what the extracted file is:

```bash
$ file sat
sat: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked (uses shared libs), for GNU/Linux 2.6.26, stripped
```

## The Dirty Work

Let's run the program

```bash
$ ./2satreloaded 
Try harder!
```

After trying some arguments, we still get "Try harder!". Time to fire up IDA and reverse the binary. The first thing we notice is that on start-up it decrypts some global variable. Let's inspect this variable once it's decrypted:


```gdb
(gdb) b *0x401004
Breakpoint 1 at 0x401004
(gdb) r
Starting program: ./2satreloaded 

Breakpoint 1, 0x0000000000401004 in ?? ()
(gdb) set print elements 0
(gdb) x/s 0x604320
0x604320:	"( a[253] | ! a[218] ) & ( ! a[92] | ! a[46] ) & ( ! a[2] | ! a[285] ) & ( ! a[275] | ! a[256] ) & ( ! a[118] | ! a[141] ) & ( a[118] | ! ! a[141] ) & ( a[19] | ! a[154] ) & ( a[272] | ! a[208] ) & ( a[249] | ! a[171] ) & ( a[84] | ! a[196] ) & ( ! a[119] | ! ! a[216] ) & ( ! a[33] | ! a[277] ) & ( a[45] | a[73] ) & ( ! a[238] | a[225] ) & ( ! a[292] | ! a[206] ) & ( a[165] | ! a[217] ) & ( ! a[102] | ! a[271] ) & ( ! a[7] | ! ! a[111] ) & ( ! a[71] | ! a[91] ) & ( ! a[29] | ! a[274] ) & ( a[29] | ! ! a[274] ) & ( a[260] | ! a[6] ) & ( ! a[49] | ! a[239] ) & ( ! a[107] | a[209] ) & ( a[150] | ! ! a[120] ) & ( ! a[155] | ! a[243] ) & ( ! a[267] | ! ! a[207] ) & ( a[169] | ! a[203] ) & ( a[69] | ! a[276] ) & ( ! ! a[9] | ! a[287] ) & ( a[42] | a[221] ) & ( ! ! a[11] | a[112] ) & ( ! ! a[148] | ! a[3] ) & ( a[262] | ! a[188] ) & ( ! a[280] | ! a[55] ) & ( ! a[150] | ! a[120] ) & ( ! a[11] | a[112] ) & ( a[109] | ! a[139] ) & ( ! a[260] | a[6] ) & ( ! a[126] | ! a[279] ) & ( a[286] | ! a[106] ) & ( ! ! a[20] | a[30] ) & ( a[123] | ! ! a[82] ) & ( ! a[174] | a[66] ) & ( a[249] | ! ! a[171] ) & ( ! a[33] | a[277] ) & ( ! a[246] | a[97] ) & ( a[201] | ! a[110] ) & ( ! ! a[143] | ! a[83] ) & ( ! ! a[7] | ! a[111] ) & ( ! ! a[47] | ! a[79] ) & ( a[172] | ! a[291] ) & ( ! a[164] | ! a[204] ) & ( a[144] | ! a[48] ) & ( ! a[47] | ! ! a[79] ) & ( ! a[20] | ! a[30] ) & ( a[50] | a[153] ) & ( ! a[242] | a[74] ) & ( a[113] | a[37] ) & ( ! ! a[191] | ! a[93] ) & ( ! a[160] | ! a[159] ) & ( ! a[98] | a[8] ) & ( a[132] | ! a[138] ) & ( ! a[247] | ! a[158] ) & ( ! a[238] | ! a[225] ) & ( ! a[2] | a[285] ) & ( a[122] | ! ! a[215] ) & ( ! a[113] | a[37] ) & ( ! a[261] | ! ! a[17] ) & ( ! a[231] | ! ! a[31] ) & ( ! ! a[147] | a[177] ) & ( a[174] | ! a[66] ) & ( ! a[245] | a[117] ) & ( a[29] | ! a[274] ) & ( a[129] |---Type <return> to continue, or q <return> to quit---
 ! a[251] ) & ( ! a[143] | ! ! a[83] ) & ( a[57] | ! a[173] ) & ( ! a[253] | a[218] ) & ( ! a[259] | a[142] ) & ( ! a[96] | ! ! a[162] ) & ( a[130] | ! ! a[88] ) & ( a[129] | ! ! a[251] ) & ( ! a[265] | ! a[192] ) & ( ! ! a[292] | ! a[206] ) & ( ! a[257] | a[266] ) & ( a[90] | ! a[75] ) & ( a[194] | ! ! a[244] ) & ( a[253] | a[218] ) & ( a[240] | a[190] ) & ( ! a[144] | ! a[48] ) & ( ! a[0] | a[100] ) & ( ! a[71] | a[91] ) & ( ! ! a[275] | ! a[256] ) & ( a[122] | ! a[215] ) & ( ! a[94] | a[241] ) & ( a[42] | ! a[221] ) & ( ! ! a[175] | a[200] ) & ( ! ! a[232] | a[198] ) & ( ! ! a[127] | ! a[15] ) & ( ! ! a[152] | ! a[25] ) & ( ! a[67] | ! a[18] ) & ( ! a[288] | a[176] ) & ( a[286] | a[106] ) & ( ! a[96] | ! a[162] ) & ( ! a[61] | ! ! a[64] ) & ( a[262] | a[188] ) & ( a[102] | ! ! a[271] ) & ( ! a[212] | ! a[63] ) & ( ! a[57] | ! a[173] ) & ( ! a[28] | a[41] ) & ( ! a[247] | ! ! a[158] ) & ( a[32] | ! a[185] ) & ( ! a[130] | ! a[88] ) & ( a[89] | ! a[161] ) & ( a[193] | ! a[168] ) & ( ! a[5] | a[195] ) & ( a[265] | ! a[192] ) & ( ! ! a[167] | ! a[179] ) & ( ! a[167] | ! a[179] ) & ( ! a[28] | ! a[41] ) & ( ! a[258] | ! a[163] ) & ( ! a[267] | ! a[207] ) & ( ! ! a[2] | a[285] ) & ( ! ! a[155] | ! a[243] ) & ( a[205] | ! a[137] ) & ( ! ! a[71] | a[91] ) & ( ! a[44] | ! a[128] ) & ( ! a[222] | a[273] ) & ( ! ! a[261] | ! a[17] ) & ( ! ! a[52] | ! a[283] ) & ( a[16] | ! a[135] ) & ( a[65] | ! ! a[43] ) & ( ! ! a[96] | ! a[162] ) & ( ! a[59] | ! ! a[199] ) & ( a[250] | ! ! a[51] ) & ( a[250] | ! a[51] ) & ( ! a[99] | a[24] ) & ( ! a[40] | ! a[145] ) & ( ! a[7] | ! a[111] ) & ( ! a[5] | ! a[195] ) & ( a[26] | ! a[180] ) & ( a[121] | ! ! a[23] ) & ( ! a[269] | ! ! a[58] ) & ( ! ! a[210] | a[213] ) & ( ! a[294] | a[10] ) & ( a[234] | ! a[34] ) & ( ! a[184] | ! a[39] ) & ( ! a[250] | ! a[51] ) & ( ! a[127] | ! a[15] ) ---Type <return> to continue, or q <return> to quit---
& ( ! a[134] | ! a[293] ) & ( ! a[261] | ! a[17] ) & ( a[0] | ! a[100] ) & ( a[68] | ! a[149] ) & ( ! a[60] | a[182] ) & ( ! a[197] | a[80] ) & ( ! a[21] | ! a[151] ) & ( ! a[272] | a[208] ) & ( ! ! a[33] | a[277] ) & ( ! a[232] | ! a[198] ) & ( ! ! a[134] | ! a[293] ) & ( ! a[119] | ! a[216] ) & ( ! a[210] | a[213] ) & ( ! a[156] | ! a[181] ) & ( a[184] | ! ! a[39] ) & ( ! ! a[60] | a[182] ) & ( ! a[275] | ! ! a[256] ) & ( ! a[264] | a[62] ) & ( ! ! a[99] | a[24] ) & ( ! a[166] | ! a[76] ) & ( ! a[187] | ! ! a[224] ) & ( ! a[234] | a[34] ) & ( ! a[186] | ! ! a[95] ) & ( ! a[284] | a[270] ) & ( ! ! a[269] | ! a[58] ) & ( ! ! a[263] | ! a[115] ) & ( a[98] | ! a[8] ) & ( ! a[103] | ! a[236] ) & ( a[0] | a[100] ) & ( ! a[59] | ! a[199] ) & ( ! a[67] | ! ! a[18] ) & ( a[150] | ! a[120] ) & ( a[230] | ! ! a[54] ) & ( a[226] | ! a[116] ) & ( ! ! a[247] | ! a[158] ) & ( ! ! a[77] | ! a[178] ) & ( ! a[172] | ! a[291] ) & ( ! a[281] | ! a[104] ) & ( ! a[1] | a[14] ) & ( a[265] | ! ! a[192] ) & ( ! ! a[187] | ! a[224] ) & ( ! ! a[197] | a[80] ) & ( a[19] | a[154] ) & ( a[289] | ! ! a[237] ) & ( ! ! a[67] | ! a[18] ) & ( a[132] | a[138] ) & ( ! a[114] | ! a[27] ) & ( a[165] | a[217] ) & ( ! a[56] | ! a[183] ) & ( ! ! a[278] | ! a[87] ) & ( a[126] | ! ! a[279] ) & ( ! a[19] | a[154] ) & ( a[258] | ! a[163] ) & ( ! a[191] | ! ! a[93] ) & ( a[288] | ! a[176] ) & ( ! ! a[212] | ! a[63] ) & ( ! a[197] | ! a[80] ) & ( ! a[61] | ! a[64] ) & ( ! ! a[146] | a[233] ) & ( ! a[44] | ! ! a[128] ) & ( ! a[129] | ! a[251] ) & ( a[65] | ! a[43] ) & ( a[230] | ! a[54] ) & ( ! a[152] | ! a[25] ) & ( ! a[146] | a[233] ) & ( ! a[170] | ! ! a[282] ) & ( a[26] | ! ! a[180] ) & ( ! a[78] | ! ! a[248] ) & ( ! a[9] | ! a[287] ) & ( a[32] | a[185] ) & ( ! a[92] | ! ! a[46] ) & ( ! ! a[231] | ! a[31] ) & ( a[226] | ! ! a[116] ) & ( ! a[127] | ! !---Type <return> to continue, or q <return> to quit---
 a[15] ) & ( ! ! a[21] | ! a[151] ) & ( ! a[278] | ! ! a[87] ) & ( a[280] | ! a[55] ) & ( ! a[131] | ! a[38] ) & ( ! a[193] | a[168] ) & ( ! a[52] | ! ! a[283] ) & ( ! a[249] | ! a[171] ) & ( ! ! a[264] | a[62] ) & ( ! a[77] | ! a[178] ) & ( a[16] | ! ! a[135] ) & ( a[294] | ! a[10] ) & ( ! ! a[170] | ! a[282] ) & ( a[234] | a[34] ) & ( ! a[290] | ! a[211] ) & ( ! ! a[156] | ! a[181] ) & ( a[245] | ! a[117] ) & ( ! ! a[189] | ! a[214] ) & ( ! a[136] | ! ! a[235] ) & ( ! a[167] | ! ! a[179] ) & ( ! a[187] | ! a[224] ) & ( a[172] | ! ! a[291] ) & ( ! ! a[186] | ! a[95] ) & ( ! a[89] | a[161] ) & ( a[257] | ! a[266] ) & ( a[288] | a[176] ) & ( a[245] | a[117] ) & ( a[113] | ! a[37] ) & ( ! ! a[40] | a[145] ) & ( ! a[166] | a[76] ) & ( a[118] | ! a[141] ) & ( a[22] | ! a[85] ) & ( ! ! a[70] | ! a[124] ) & ( ! ! a[255] | a[105] ) & ( ! a[136] | ! a[235] ) & ( ! a[286] | a[106] ) & ( ! ! a[92] | ! a[46] ) & ( ! ! a[1] | a[14] ) & ( a[56] | ! ! a[183] ) & ( ! a[78] | ! a[248] ) & ( ! ! a[246] | a[97] ) & ( ! a[231] | ! a[31] ) & ( ! ! a[267] | ! a[207] ) & ( a[121] | ! a[23] ) & ( ! ! a[114] | ! a[27] ) & ( a[108] | ! ! a[202] ) & ( ! a[40] | a[145] ) & ( a[254] | a[86] ) & ( ! a[13] | a[35] ) & ( ! a[121] | ! a[23] ) & ( ! a[52] | ! a[283] ) & ( ! a[175] | a[200] ) & ( ! a[268] | ! a[36] ) & ( ! a[189] | ! a[214] ) & ( ! a[134] | ! ! a[293] ) & ( a[126] | ! a[279] ) & ( a[194] | ! a[244] ) & ( a[205] | a[137] ) & ( ! a[84] | ! a[196] ) & ( ! a[169] | ! a[203] ) & ( ! a[11] | ! a[112] ) & ( a[81] | ! ! a[252] ) & ( ! ! a[259] | a[142] ) & ( ! a[219] | ! a[227] ) & ( ! a[226] | ! a[116] ) & ( a[169] | ! ! a[203] ) & ( ! a[194] | ! a[244] ) & ( ! a[147] | ! a[177] ) & ( ! a[146] | ! a[233] ) & ( ! a[4] | ! ! a[72] ) & ( ! ! a[268] | a[36] ) & ( ! a[131] | a[38] ) & ( ! a[45] | a[73] ) & ( a[45] | ! a[73] ) & ( ! a[191---Type <return> to continue, or q <return> to quit---
] | ! a[93] ) & ( ! a[133] | a[157] ) & ( a[89] | a[161] ) & ( ! a[165] | a[217] ) & ( a[84] | ! ! a[196] ) & ( ! a[268] | a[36] ) & ( ! a[152] | ! ! a[25] ) & ( ! a[269] | ! a[58] ) & ( ! a[50] | a[153] ) & ( a[94] | ! a[241] ) & ( ! a[290] | ! ! a[211] ) & ( ! a[264] | ! a[62] ) & ( ! ! a[53] | a[229] ) & ( ! ! a[228] | ! a[12] ) & ( ! a[222] | ! a[273] ) & ( ! ! a[28] | a[41] ) & ( ! a[148] | ! a[3] ) & ( ! a[170] | ! a[282] ) & ( a[22] | ! ! a[85] ) & ( ! a[262] | a[188] ) & ( ! a[254] | a[86] ) & ( ! a[242] | ! a[74] ) & ( ! a[26] | ! a[180] ) & ( a[102] | ! a[271] ) & ( ! ! a[166] | a[76] ) & ( a[49] | ! a[239] ) & ( ! a[189] | ! ! a[214] ) & ( a[184] | ! a[39] ) & ( a[108] | ! a[202] ) & ( a[123] | ! a[82] ) & ( ! a[107] | ! a[209] ) & ( ! a[143] | ! a[83] ) & ( ! a[284] | ! a[270] ) & ( ! a[156] | ! ! a[181] ) & ( ! ! a[238] | a[225] ) & ( ! a[205] | a[137] ) & ( ! a[263] | ! a[115] ) & ( ! a[22] | ! a[85] ) & ( ! a[175] | ! a[200] ) & ( ! ! a[125] | ! a[140] ) & ( ! a[230] | ! a[54] ) & ( ! a[232] | a[198] ) & ( a[254] | ! a[86] ) & ( ! a[70] | ! a[124] ) & ( ! a[212] | ! ! a[63] ) & ( ! ! a[242] | a[74] ) & ( a[160] | ! ! a[159] ) & ( a[69] | ! ! a[276] ) & ( ! a[70] | ! ! a[124] ) & ( ! a[68] | ! a[149] ) & ( ! a[263] | ! ! a[115] ) & ( ! a[201] | a[110] ) & ( ! a[60] | ! a[182] ) & ( ! ! a[131] | a[38] ) & ( ! a[47] | ! a[79] ) & ( a[56] | ! a[183] ) & ( ! a[278] | ! a[87] ) & ( a[130] | ! a[88] ) & ( ! a[122] | ! a[215] ) & ( ! ! a[119] | ! a[216] ) & ( ! a[1] | ! a[14] ) & ( a[133] | ! a[157] ) & ( ! a[155] | ! ! a[243] ) & ( ! a[123] | ! a[82] ) & ( a[281] | ! ! a[104] ) & ( ! ! a[290] | ! a[211] ) & ( a[68] | ! ! a[149] ) & ( ! a[53] | ! a[229] ) & ( a[193] | a[168] ) & ( ! a[81] | ! a[252] ) & ( a[81] | ! a[252] ) & ( a[201] | a[110] ) & ( ! ! a[61] | ! a[64] ) & ( a[294] | a[10] ) & ( ! a[11---Type <return> to continue, or q <return> to quit---
4] | ! ! a[27] ) & ( a[50] | ! a[153] ) & ( a[289] | ! a[237] ) & ( a[258] | ! ! a[163] ) & ( ! a[132] | a[138] ) & ( ! a[125] | ! a[140] ) & ( ! a[32] | a[185] ) & ( ! a[228] | ! a[12] ) & ( ! a[103] | ! ! a[236] ) & ( ! a[69] | ! a[276] ) & ( a[13] | a[35] ) & ( ! a[4] | ! a[72] ) & ( ! a[109] | ! a[139] ) & ( ! a[125] | ! ! a[140] ) & ( ! a[108] | ! a[202] ) & ( a[90] | ! ! a[75] ) & ( ! ! a[164] | ! a[204] ) & ( ! a[65] | ! a[43] ) & ( ! a[16] | ! a[135] ) & ( a[174] | a[66] ) & ( a[94] | a[241] ) & ( a[144] | ! ! a[48] ) & ( ! a[77] | ! ! a[178] ) & ( ! a[9] | ! ! a[287] ) & ( ! a[240] | a[190] ) & ( ! ! a[223] | ! a[101] ) & ( ! a[186] | ! a[95] ) & ( ! a[90] | ! a[75] ) & ( ! ! a[219] | ! a[227] ) & ( ! ! a[44] | ! a[128] ) & ( a[281] | ! a[104] ) & ( ! a[21] | ! ! a[151] ) & ( a[13] | ! a[35] ) & ( ! a[99] | ! a[24] ) & ( ! a[42] | a[221] ) & ( ! a[292] | ! ! a[206] ) & ( ! a[20] | a[30] ) & ( ! a[228] | ! ! a[12] ) & ( a[49] | ! ! a[239] ) & ( a[57] | ! ! a[173] ) & ( ! a[223] | ! a[101] ) & ( ! a[255] | a[105] ) & ( ! ! a[78] | ! a[248] ) & ( ! a[148] | ! ! a[3] ) & ( ! a[53] | a[229] ) & ( ! a[246] | ! a[97] ) & ( ! ! a[103] | ! a[236] ) & ( ! a[219] | ! ! a[227] ) & ( ! a[289] | ! a[237] ) & ( ! ! a[4] | ! a[72] ) & ( ! ! a[222] | a[273] ) & ( a[98] | a[8] ) & ( a[280] | ! ! a[55] ) & ( ! ! a[107] | a[209] ) & ( ! ! a[284] | a[270] ) & ( a[133] | a[157] ) & ( a[272] | a[208] ) & ( ! a[223] | ! ! a[101] ) & ( a[260] | a[6] ) & ( a[257] | a[266] ) & ( a[160] | ! a[159] ) & ( a[109] | ! ! a[139] ) & ( ! a[255] | ! a[105] ) & ( a[240] | ! a[190] ) & ( ! ! a[5] | a[195] ) & ( ! a[210] | ! a[213] ) & ( ! a[259] | ! a[142] ) & ( ! a[164] | ! ! a[204] ) & ( ! a[147] | a[177] ) & ( ! ! a[59] | ! a[199] ) & ( ! ! a[136] | ! a[235] )\n\n"
```

Why that's a very large 2-SAT formula! Right after decrypting the 2-SAT formula, the program checks whether `argv[1]` is present, and whether it consists only of `0`'s  and `1`'s. Additionally the argument must have a length of `295`. Notice that in the 2-SAT formula the highest index is `294`. This matches the requirement that the argument must have a length of `295`. It appears the argument encodes the assignment to each variable, and that this assignment must satisfy the formula.

Using [`pycosat`](https://pypi.python.org/pypi/pycosat) we can easily solve the 2-SAT formula:

```python
import re, pycosat

formula = "( a[253] | ! a[218] ) & [.. see gdb output ..]"
re_index = re.compile(r'a\[(\d+)\]')

def parse_literal(literal):
    negs = 1 if literal.count("!") % 2 == 0 else -1
    num = int(re_index.search(literal).group(1)) + 1
    return negs * num

def parse_clause(clause):
    literals = clause.split(" | ")
    return [parse_literal(l) for l in literals]

def parse_formula(formula):
    clauses = [clause[2:-2] for clause in formula.split(" & ")]
    return [parse_clause(clause) for clause in clauses]

cnf = parse_formula(formula)
solution = pycosat.solve(cnf)
print "Solution:", "".join(['1' if x > 0 else '0' for x in solution])
```

Running the challenge with as argument the solution gives us the flag:

```bash
$ ./2satreloaded 1000001010100110100100101010011010111110011001000110000011000010011011000110100011001010011100100110101001101110110001100111001001101100011000101100001001100100110001001100101011000010110010100111001011000100110001000110010001100110011000001100010001100110011010100110001011000100110001101100001
ASIS_20a64e957c961a2beae9bb230b351bca
```

## Other write-ups and resources

* [Write-up by Souhail Hammou](http://rce4fun.blogspot.be/2014/10/asis-ctf-finals-2014-satellite-reloaded.html)
* [Write-up by Balalaika Cr3w](http://ctfcrew.org/writeup/83)